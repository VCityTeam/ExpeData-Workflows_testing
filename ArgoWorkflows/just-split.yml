apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: parameters-
spec:
  entrypoint: main
  volumes:
  - name: workdir
    hostPath:
      path: /data/host
  arguments:
    parameters:
    - name: persistedVolume   
      value: /within-container-mount-point/

  templates:
  - name: main
    steps:
    # Warning: this assumes that just-collect was ran before
    - - name: split-buildings-loop
        templateRef:
          name: workflow-template-atomic-steps-template
          template: split-buildings-template
        arguments:
          parameters:
          - name: input_filename
            value: "{{workflow.parameters.experiment_output_dir}}/stage_1/{{item}}_{{workflow.parameters.vintage}}/{{item}}_{{workflow.parameters.pattern}}_{{workflow.parameters.vintage}}.gml"
          - name: output_dir
            value: "{{workflow.parameters.experiment_output_dir}}/stage_2/{{item}}_{{workflow.parameters.vintage}}"
          - name: output_filename
            value: "{{item}}_{{workflow.parameters.pattern}}_{{workflow.parameters.vintage}}_split.gml"
          - name: persistedVolume
            value: "{{workflow.parameters.persistedVolume}}"
        withParam: "{{workflow.parameters.boroughs}}"

    - - name: print-file-names
        templateRef:
          name: workflow-template-utils-whalesay-template
          template: whalesay-template
        arguments:
          parameters:
          - name: message
            value: "{{steps.split-buildings-loop.outputs.parameters.resulting-filenames}}"
